---
description: ライブおよびビデオオンデマンド (VOD) メディアの場合、 TVSDK は、中解像度ビットレートに関連付けられたプレイリストのダウンロードで再生を開始し、そのプレイリストで定義されたメディアセグメントをダウンロードします。 高解像度ビットレートのプレイリストとそれに関連するメディアをすばやく選択し、ダウンロード処理を続行します。
title: メディアの再生とフェイルオーバー
source-git-commit: 02ebc3548a254b2a6554f1ab34afbb3ea5f09bb8
workflow-type: tm+mt
source-wordcount: '654'
ht-degree: 0%

---

# メディアの再生とフェイルオーバー{#media-playback-and-failover}

ライブおよびビデオオンデマンド (VOD) メディアの場合、 TVSDK は、中解像度ビットレートに関連付けられたプレイリストのダウンロードで再生を開始し、そのプレイリストで定義されたメディアセグメントをダウンロードします。 高解像度ビットレートのプレイリストとそれに関連するメディアをすばやく選択し、ダウンロード処理を続行します。

## プレイリストのフェイルオーバーが見つかりません {#section_E6B6A15930894F56A0A8501577B35E7F}

プレイリスト全体が見つからない場合（トップレベルのマニフェストファイルで指定されている M3U8 ファイルがダウンロードされない場合など）、 TVSDK は復元を試みます。 復元できない場合は、次の手順がアプリケーションによって決定されます。

中解像度のビットレートに関連付けられているプレイリストがない場合、 TVSDK は同じ解像度のバリアントプレイリストを検索します。 同じ解像度が見つかった場合は、バリアントプレイリストとセグメントを一致する位置からダウンロードし始めます。 TVSDK が同じ解像度のプレイリストを見つけられない場合は、他のビットレート再生リストとそのバリアントを順に切り替えようとします。 すぐ下のビットレートが最初の選択肢で、その次にそのバリアントがその後に続きます。 有効なプレイリストを見つけようとして、低いビットレートの再生リストとそのバリアントがすべて使い果たされた場合、 TVSDK は最上位のビットレートに移動し、そこからカウントダウンします。 有効なプレイリストが見つからない場合、プロセスは失敗し、プレーヤーは ERROR 状態に移行します。

この状況の処理方法は、アプリケーションによって決定されます。 例えば、プレーヤーアクティビティを閉じて、ユーザーをカタログアクティビティに誘導するとします。 関心のあるイベントは、 `STATUS_CHANGED` イベントを呼び出し、対応するコールバックが `onStatusChange` メソッド。 プレーヤーが内部状態を ERROR に変更したかどうかを監視するコードを次に示します。

詳しくは、 `PSDKDemo` ファイル。 イベントリスナーは MediaPlayer インスタンスに接続されます。

```
case MediaPlayerStatus.ERROR: 
Alert.show(event.error.toString(), “Error occurred”); 
break;
```

クライアント側のネットワークがダウンしている場合は、このコードを使用して検証できます。

```
psdkutils::PSDKString 
getNetworkDownVerificationUrl() const { return 
_networkDownVerificationUrl; }
```

API は、クライアント側のネットワークがダウンしているかどうかを確認するために使用される URL を提供します。 HTTP リクエストに対して HTTP 応答コード 200 を返す有効な URL を指定する必要があります。

```
psdkutils::PSDKErrorCode 
 setNetworkDownVerificationUrl(psdkutils::PSDKString value) {  
_networkDownVerificationUrl = value; return psdkutils::kECSuccess; }
```

setNetworkDownVerificationUrl が設定されていない場合、 TVSDK はデフォルトで MainManifest の URL を使用して、ネットワークがダウンしているかどうかを示します。

## セグメントフェイルオーバーが見つかりません {#section_ED8CF666289042D39E9914D42BDD9BA4}

セグメントが見つからない場合（特定のセグメントのダウンロードに失敗した場合など）、 TVSDK は様々なフェイルオーバー試行を通じて復元を試みます。 回復できない場合は、エラーを発行します。

例えば、マニフェストファイルが存在しない場合や、セグメントをダウンロードできない場合などに、サーバー上でセグメントが見つからない場合は、 TVSDK は次のオプションを試行してフェイルオーバーを試みます。

1. バリアントファイル内の同じビットレートで、同じセグメントに対するフェイルオーバーを試みます。
1. 同じファイル内の別のビットレートに切り替えます（ABR スイッチ）。
1. 使用可能なすべてのバリアントで使用可能なすべてのビットレートを順に切り替えます。
1. セグメントをスキップし、警告を表示します。

TVSDK は、別のセグメントを取得できない場合、トリガーを `CONTENT_ERROR` エラー通知。 この通知には、コードが記述された内部通知が含まれています `DOWNLOAD_ERROR` コード。 問題のあるストリームが代替オーディオトラックの場合、 TVSDK は `AUDIO_TRACK_ERROR` エラー通知。

ビデオエンジンが引き続きセグメントを取得できない場合、セグメントの連続スキップ数は 5 に制限されます。5 を超えた後は、再生が停止し、 TVSDK が `NATIVE_ERROR` を 5 番目のコードに置き換えます。

>[!NOTE]
>
>フェイルオーバーが発生した場合、可変ビットレート (ABR) 制御パラメーターは考慮されません。 これは、フェイルオーバーメカニズムが、ビットレートプロファイルに関係なく、現在使用可能な再生リストをバックアップストリームとして使用するように設計されているためです。
>
>フェイルオーバー操作中は、プロファイルスイッチが存在する場合があります。 プレイリストセグメントの 1 つのダウンロード中にエラーが発生した場合、許可される最小/最大ビットレートなどの ABR 制御パラメーターは無視されます。
