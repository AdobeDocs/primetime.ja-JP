---
description: ライブおよびビデオオンデマンド(VOD)メディアの場合、TVSDKは、中解像度ビットレートに関連付けられたプレイリストのダウンロードによって再生を開始し、そのプレイリストで定義されたメディアセグメントをダウンロードします。 高解像度ビットレートプレイリストと関連メディアをすばやく選択し、ダウンロード処理を続行します。
seo-description: ライブおよびビデオオンデマンド(VOD)メディアの場合、TVSDKは、中解像度ビットレートに関連付けられたプレイリストのダウンロードによって再生を開始し、そのプレイリストで定義されたメディアセグメントをダウンロードします。 高解像度ビットレートプレイリストと関連メディアをすばやく選択し、ダウンロード処理を続行します。
seo-title: メディアの再生とフェイルオーバー
title: メディアの再生とフェイルオーバー
uuid: 197a6ee0-f1ff-40ac-bd49-eafeae6167d4
translation-type: tm+mt
source-git-commit: 040655d8ba5f91c98ed0584c08db226ffe1e0f4e

---


# メディアの再生とフェイルオーバー{#media-playback-and-failover}

ライブおよびビデオオンデマンド(VOD)メディアの場合、TVSDKは、中解像度ビットレートに関連付けられたプレイリストのダウンロードによって再生を開始し、そのプレイリストで定義されたメディアセグメントをダウンロードします。 高解像度ビットレートプレイリストと関連メディアをすばやく選択し、ダウンロード処理を続行します。

## プレイリストのフェイルオーバーが見つかりません {#section_E6B6A15930894F56A0A8501577B35E7F}

プレイリスト全体が見つからない場合（例えば、最上位のマニフェストファイルで指定されたM3U8ファイルがダウンロードされない場合）、TVSDKは回復を試みます。 回復できない場合は、次の手順をアプリケーションが決定します。

中解像度のビットレートに関連付けられているプレイリストがない場合、TVSDKは同じ解像度のバリアントプレイリストを検索します。 同じ解像度が見つかると、バリアントプレイリストとセグメントを一致する位置からダウンロードし始めます。 TVSDKが同じ解像度プレイリストを見つけない場合、他のビットレートプレイリストとそのバリエーションを順に切り替えようとします。 すぐに低いビットレートが最初の選択肢で、その次にそのバリエーションなどがあります。 有効なプレイリストを見つけようとして、下位ビットレートの再生リストとそのバリエーションがすべて使い果たされた場合、TVSDKは最上位ビットレートに移動し、そこからカウントダウンします。 有効なプレイリストが見つからない場合、プロセスは失敗し、プレイヤーはERROR状態に移行します。

この状況の処理方法は、アプリケーションで決定できます。 例えば、プレイヤーアクティビティを閉じて、ユーザーをカタログアクティビティに誘導することができます。 関心のあるイベントはイベント `STATUS_CHANGED` で、対応するコールバックがメソッド `onStatusChange` です。 以下のコードは、プレーヤーが内部状態をERRORに変更したかどうかを監視するコードです。

詳しくは、ファイルを参照してく `PSDKDemo` ださい。 イベントリスナーは、MediaPlayerインスタンスにアタッチされます。

```
case MediaPlayerStatus.ERROR: 
Alert.show(event.error.toString(), “Error occurred”); 
break;
```

クライアント側のネットワークがダウンしている場合は、このコードを使用して検証できます。

```
psdkutils::PSDKString 
getNetworkDownVerificationUrl() const { return 
_networkDownVerificationUrl; }
```

APIは、クライアント側のネットワークがダウンしているかどうかを確認するために使用されるURLを提供します。 これは、http要求時にhttp応答コード200を返す有効なURLである必要があります。

```
psdkutils::PSDKErrorCode 
 setNetworkDownVerificationUrl(psdkutils::PSDKString value) {  
_networkDownVerificationUrl = value; return psdkutils::kECSuccess; }
```

setNetworkDownVerificationUrlが設定されていない場合、TVSDKは、デフォルトでMainManifest urlを使用して、ネットワークがダウンしているかどうかを示します。

## セグメントのフェイルオーバーが見つかりません {#section_ED8CF666289042D39E9914D42BDD9BA4}

特定のセグメントのダウンロードに失敗した場合など、セグメントが見つからない場合、TVSDKは様々なフェイルオーバー試行を通じて回復を試みます。 回復できない場合は、エラーが発生します。

例えば、マニフェストファイルが存在しないためにサーバー上でセグメントが見つからない場合、セグメントをダウンロードできず、以下のオプションを試して、TVSDKがフェイルオーバーを試みます。

1. バリアントファイル内の同じビットレートで、同じセグメントへのフェイルオーバーを試みます。
1. 同じファイル内の代替ビットレート（ABRスイッチ）に切り替えます。
1. 使用可能なすべてのバリアント内の使用可能なすべてのビットレートを順に調べます。
1. セグメントをスキップして警告を発行します。

TVSDKは、代替セグメントを取得できない場合、エラー通知をトリガ `CONTENT_ERROR` ーします。 この通知には、コードコードを含む内部通知が含ま `DOWNLOAD_ERROR` れます。 問題のあるストリームが代替オーディオトラックの場合、TVSDKはエラー通知を `AUDIO_TRACK_ERROR` 生成します。

ビデオエンジンが引き続きセグメントを取得できない場合は、セグメントの連続スキップ数を5に制限します。5に制限すると、再生が停止し、TVSDKがコード5で `NATIVE_ERROR` Aを発行します。

>[!NOTE]
>
>フェイルオーバーが発生した場合、可変ビットレート(ABR)制御パラメータは考慮されません。 これは、フェイルオーバーメカニズムが、ビットレートプロファイルに関係なく、現在使用可能な再生リストのいずれかをバックアップストリームとして使用するように設計されているためです。
>
>フェイルオーバー操作中に、プロファイルスイッチが存在する可能性があります。 プレイリストセグメントの1つのダウンロード中にエラーが発生した場合、最小/最大許容ビットレートなどのABR制御パラメーターは無視されます。

