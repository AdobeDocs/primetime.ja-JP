---
description: ライブビデオストリームのブラックアウトを処理し、ブラックアウト中に代替コンテンツを提供できます。
title: ブラックアウトAPI要素
translation-type: tm+mt
source-git-commit: 89bdda1d4bd5c126f19ba75a819942df901183d1
workflow-type: tm+mt
source-wordcount: '578'
ht-degree: 0%

---


# ブラックアウトAPI要素{#blackout-api-elements}

ライブビデオストリームのブラックアウトを処理し、ブラックアウト中に代替コンテンツを提供できます。

ライブストリームでブラックアウトが発生した場合、プレイヤーはイベントハンドラーを使用してブラックアウトを検出し、メインストリームを視聴する資格のないユーザーに代替コンテンツを提供します。 プレイヤーは、ブラックアウト期間の開始と終了を検出し、再生をメインストリームから代替ストリームに切り替え、ブラックアウト期間が終了したらメインストリームに切り替えます。

ライブストリーム内のブラックアウトを処理するには：

1. ライブストリームマニフェストのブラックアウトタグをサブスクライブすることで、ブラックアウトタグを検出するようにアプリを設定します。

   TVSDKは、ブラックアウトタグをそれ自体で検出しません。マニフェストファイルの解析中にタグを検出した場合に通知を受け取るには、ブラックアウトタグをサブスクライブする必要があります。
1. プレイヤーがサブスクライブしているタグ（この場合はPLAYBACKタグおよびBLACKOUTSタグ）用のイベントリスナーを作成します。

   プレイヤーがフォアグラウンド（メインコンテンツ）またはバックグラウンド（代替コンテンツ）のストリームマニフェストでサブスクライブしたタグ（ブラックアウトタグなど）が発生すると、TVSDKは`TimedMetadataEvent`をディスパッチし、`TimedMetadataEvent`の`TimedMetadataObject`を作成します。

1. フォアグラウンドストリームとバックグラウンドストリームの両方に対して時間指定メタデータイベントーのハンドラーを実装します。

   これらのハンドラーで、時間指定メタデータイベントオブジェクトから、ブラックアウト期間の開始および終了時間を取得します。
1. ブラックアウト期間の開始時と終了時にコンテンツを切り替える方法を作成します。

   ブラックアウト期間の開始が発生した場合は、メインコンテンツをバックグラウンドに切り替え、代替コンテンツがメインストリームになるように切り替えます。 引き続き、バックグラウンドで元のマニフェストの取得と解析を行い、「ブラックアウト終了」タグをチェックし続けます。これにより、ブラックアウトが終了したときにプレイヤーが元のストリームに再結合できます。
1. ブラックアウト範囲が再生ストリームのDVRに含まれる場合は、シーク不可能範囲を更新します。

   ブラックアウトシーク不可能範囲を作成および更新することにより、バックグラウンドストリーム上の`TimedMetadata`を追跡し、処理します。

TVSDKは、メソッド、メタデータ、通知など、ブラックアウトの実装に役立つAPIエレメントを提供します。

プレイヤーにブラックアウトソリューションを実装する場合は、以下を使用できます。

* **MediaPlayer**

   * `registerCurrentItemAsBackgroundItem` 現在読み込まれているリソースをバックグラウンドリソースとして保存します。このメソッドの後に`replaceCurrentResource`を呼び出すと、`unregisterCurrentBackgroundItem`、`release`、または`reset`を呼び出すまで、TVSDKはバックグラウンドアイテムのマニフェストのダウンロードを続行します。

   * `unregisterCurrentBackgroundItem` バックグラウンドアイテムをnullに設定し、バックグラウンドマニフェストのフェッチおよび解析を停止します。

* **BlackoutMetadata** -

   ブラックアウトに固有のMetadataクラス。

   これにより、TVSDKにシーク不可能範囲（`TimeRanges`の配列）を設定できます。 TVSDKは、ユーザーがシークするたびに、これらの範囲をチェックします。 この変数が設定され、ユーザーがシーク不可能範囲をシークした場合、TVSDKは視聴者をシーク不可能範囲の終わりまで強制的に移動させます。

* **開始HERE NEXT** AdvertisingMetadataEnableまたはdisableライブストリーム上のプリロールを有効または無効にします。そ `enableLivePreroll` のためには、trueまたはfalseに設定します。falseの場合、TVSDKは、コンテンツ再生前にプリロール広告に対する明示的な広告サーバー呼び出しを行わないので、プリロールは再生されません。 これは、ミッドロールには影響しません。 デフォルトはtrueです。

* **MediaPlayer.BlackoutsEventListener**

   * `onTimedMetadataInBackgroundItem`  — バックグラウンドマニフェスト内でサブスクライブ済みのタグを検出し、そこから新しい `TimedMetadata` インスタンスを作成するとディスパッチされます。`TimedMetadata`インスタンスがパラメーターとしてディスパッチされます。

   * `onBackgroundManifestFailed`  — メディアプレイヤーがバックグラウンドマニフェストの読み込みに完全に失敗した、つまり、すべてのストリームURLがエラーまたは無効な応答を返した場合にディスパッチされます。

* **通知**

   * `BACKGROUND_MANIFEST_WARNING`

      * コード：204000
      * タイプ：警告
      * バックグラウンドマニフェストのダウンロードでエラーが発生しました。