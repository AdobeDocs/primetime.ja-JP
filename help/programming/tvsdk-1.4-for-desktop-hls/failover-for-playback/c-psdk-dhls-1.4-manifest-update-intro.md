---
description: TVSDK は、ライブストリーミング用のマスター m3u8 マニフェストで変更された再生情報を検出し、ストリームの再生中に再生情報を更新することができます。 TVSDK は、更新間で重複しないプロファイルのビットレートを含め、プロファイルがマスターマニフェストに表示されたり、マスターマニフェストから消えたりする際に、ビットレートプロファイルの動的なセットをサポートします。
title: ライブマスターマニフェストの更新
source-git-commit: 02ebc3548a254b2a6554f1ab34afbb3ea5f09bb8
workflow-type: tm+mt
source-wordcount: '740'
ht-degree: 0%

---

# ライブマスターマニフェストの更新{#live-master-manifest-update}

TVSDK は、ライブストリーミング用のマスター m3u8 マニフェストで変更された再生情報を検出し、ストリームの再生中に再生情報を更新することができます。 TVSDK は、更新間で重複しないプロファイルのビットレートを含め、プロファイルがマスターマニフェストに表示されたり、マスターマニフェストから消えたりする際に、ビットレートプロファイルの動的なセットをサポートします。

次の機能がサポートされています。

* プロファイル数（増減）
* プロファイルのビットレート（重複する、または重複しない）
* 同じ（または異なる）サーバー上に URL を持つプロファイル
* 任意のフェイルオーバー構造

次の条件をすべて満たす必要があります。

* ストリームがライブです。
* 時間と etag の両方が変更されます。
* すべてのレンディション情報は同じままです（URL が異なる場合を除く）。
* DRM アクセス情報は変わりません。
* セグメントは、同じ PTS とフレーム境界の周りに小さなエラー範囲でパッケージ化されます。

## ライブマスターマニフェストの更新アーキテクチャ {#section_32254A0F684B4960ACC33BF6B1AEF6F1}

以下に、 TVSDK が更新されたマスターマニフェストにどのように対応するかに関する情報と例を示します。

デフォルトでは、この機能はオフになっています。 更新頻度を分単位で設定して、アプリケーションが ON にした場合、更新間隔ごとに次の手順が実行されます。

1. TVSDK は、マスターマニフェストの最終変更時間と etag を調べて、ファイルが更新されたかどうかを判断します。

   時刻と etag の両方が変更された場合、ファイルは変更済みと見なされます。
1. TVSDK は、新しいマニフェストを解析および分析し、更新の性質に基づいて適切なアクションを実行します。
1. 現在の再生ビットレートが変更されたマニフェストのビットレートと一致する場合、 TVSDK は新しいプロファイルに切り替わります。

   新しいプロファイルは、別のサーバーまたは同じサーバーからのもので、同じビットレートで生成される場合があります。 この場合、トランジションはスムーズです。
1. 現在の再生ビットレートが新しいマニフェストに存在しない場合、 TVSDK は、新しいマニフェストにも存在する現在のプロファイル内のビットレートを探します。

   * 一致が見つかった場合、プレーヤーはまず既存のマニフェスト内の一致ビットレートプロファイルに切り替え、更新されたマニフェスト内の一致ビットレートプロファイルに切り替えます。 これにより、トランジションがスムーズになります。
   * 前のマニフェストと新しいマニフェストの間にビットレートが共通でない場合、または TVSDK が一致するビットレートに切り替えられない場合、 TVSDK は新しいマニフェストの最も低いビットレートプロファイルに直接切り替え、ABR を使用して帯域幅に基づいて許容されるビットレートに切り替えます。 これは、再生に軽度の問題が発生する可能性がありますが、影響は最小限に抑える必要があります。

1. 更新が成功すると、 TVSDK は `MediaPlayerItemEvent.MASTER_UPDATED` イベント。
1. 更新が成功しなかった場合、この更新の前からセットアップを使用して再生が続行されます。

### 例 1 {#example_DB55F2B9D98741628C9B973E47A0B6A0}

次のビットレートがライブ放送されています。

* 500k
* 900k
* 2100k

2100k ストリームに問題が発生したので、再起動する必要があります。 マスターマニフェストが更新され、500,000,000 と 900k しか含まれなくなります。 その後すぐに、2100k でこのプログラムを見ているユーザーは、ビットレートが 900k に切り替わります。 900k で視聴しているユーザーは、900k で視聴し続けます。 その後、2100k ストリームが再開され、マスターマニフェストに再び追加されます。 しばらくすると、900k で視聴し、帯域幅を持つユーザーは、2100k に切り替えられます。

### 例 2 {#example_485E9A9F373D454CADE5395DEC734E5D}

次のビットレートがライブ放送されています。

* 500k
* 900k
* 2100k

これらのビットレートはすべて再起動する必要があります。 これに対して、400 k と 1500 k の 2 つの一時的なストリームが設定されています。 ユーザーは、新しい設定で最も低いビットレートである 400k に切り替えられます。 帯域幅が十分な場合、一部のユーザーは 1500k に切り替えられます。 その後、3 つのビットレートがバックアップされ、マスターマニフェストが更新されます。 ユーザーは自動的に 500k で視聴するように切り替えます。これは、改訂された（元の）マニフェストで最も低い帯域幅です。 しばらくすると、ユーザーは、自社のネットワークで許容される最大帯域幅（900k または 1200k）に切り替えられます。

## ライブマスターマニフェストの更新を使用 {#section_34AC4A9751DB4B7C8561302C6A59A1C4}

この機能をオンにして、関連するイベントを確認できます。

1. ライブマスターマニフェストの更新を有効にするには、 `NetworkConfiguration.masterUpdateInterval` プロパティ。
1. オプションで、成功したマニフェストの更新を、 `MediaPlayerItemEvent.MASTER_UPDATED` イベント。
