---
description: ビデオオンデマンド(VOD)の広告挿入プロセスは、広告解決、広告挿入および広告再生の各段階で構成されます。 広告トラッキングの場合、TVSDKは、各広告の再生の進行状況をリモートトラッキングサーバーに通知する必要があります。 予期しない状況が発生した場合、TVSDKは適切なアクションを実行します。
seo-description: ビデオオンデマンド(VOD)の広告挿入プロセスは、広告解決、広告挿入および広告再生の各段階で構成されます。 広告トラッキングの場合、TVSDKは、各広告の再生の進行状況をリモートトラッキングサーバーに通知する必要があります。 予期しない状況が発生した場合、TVSDKは適切なアクションを実行します。
seo-title: VODの広告挿入とフェイルオーバー
title: VODの広告挿入とフェイルオーバー
uuid: 1f813065-9310-4495-9fbb-d90eda8ac8bd
translation-type: tm+mt
source-git-commit: 812d04037c3b18f8d8cdd0d18430c686c3eee1ff

---


# VODの広告挿入とフェイルオーバー {#advertising-insertion-and-failover-for-vod}

ビデオオンデマンド(VOD)の広告挿入プロセスは、広告解決、広告挿入および広告再生の各段階で構成されます。 広告トラッキングの場合、TVSDKは、各広告の再生の進行状況をリモートトラッキングサーバーに通知する必要があります。 予期しない状況が発生した場合、TVSDKは適切なアクションを実行します。

## 広告解決フェーズ {#section_5DD3A7DA79E946298BFF829A60202E1C}

TVSDKは、Adobe Primetime ad decisioningなどの広告配信サービスに接続し、広告のビデオストリームに対応するプライマリプレイリストファイルの取得を試みます。 広告解決フェーズ中に、TVSDKはリモート広告配信サーバーに対するHTTP呼び出しを行い、サーバーの応答を解析します。

TVSDKは、次のタイプの広告プロバイダーをサポートしています。

* メタデータ広告プロバイダー

   広告データはプレーンテキストのJSONファイルにエンコードされます。
* Primetime ad decisioning広告プロバイダー

   TVSDKは、一連のターゲティングパラメーターとアセットID番号を含むリクエストを、Primetime ad decisioningバックエンドサーバーに送信します。 Primetime ad decisioningは、必要な広告情報を含むSMIL(Synchronized Multimedia Integration Language)ドキュメントを使用して応答します。
* カスタム広告マーカープロバイダー

   広告がサーバー側からストリームに焼き込まれる状況を処理します。 TVSDKは、実際の広告挿入を実行しませんが、サーバー側で挿入された広告を追跡する必要があります。 このプロバイダーは、TVSDKが広告トラッキングの実行に使用する広告マーカーを設定します。

このフェーズでは、次のいずれかのフェイルオーバー状況が発生する可能性があります。

* データを取得できません。例えば、接続が不足している場合や、リソースが見つからない場合など、サーバー側のエラーが発生した場合などです。
* データが取得されましたが、形式が無効です。

   これは、例えば、受信データの解析に失敗した場合に発生する可能性があります。

TVSDKは、エラーに関する警告通知を発行し、処理を続行します。

## 広告挿入フェーズ {#section_29F7F7756C8B40B99AD4C3DD16B72B5B}

TVSDKは、メインコンテンツに対応するタイムラインに代替コンテンツ（広告）を挿入します。

広告解決フェーズが完了すると、TVSDKは、広告の時間にグループ化された広告リソースの順番に並べられたリストを持ちます。 各広告の時間は、ミリ秒(ms)で表される開始時間値を使用して、メインコンテンツのタイムライン上に配置されます。 広告の時間内の各広告には、同時にミリ秒単位で表されるdurationプロパティがあります。 広告の時間内の広告は連結され、その結果、広告の時間の長さは、構成する個々の広告の継続時間の合計と等しくなります。

このフェーズでは、広告挿入中にタイムラインで発生する可能性のある競合と共に、フェイルオーバーが発生する可能性があります。 広告の時間の開始時間/時間の値を特定の組み合わせで組み合わせると、広告セグメントが重複する場合があります。 この重複は、広告の時間の最後の部分が、次の広告の時間の最初の広告の先頭と交差する場合に発生します。 このような状況では、TVSDKは後の広告の時間を破棄し、すべての広告の時間が挿入または破棄されるまで、リスト上の次の項目を使用して広告挿入プロセスを続行します。

TVSDKは、エラーに関する警告通知を発行し、処理を続行します。

## 広告再生フェーズ {#section_DA816F88AF8A4A5A8FD0DE2D54A86031}

TVSDKは、広告セグメントをダウンロードし、デバイスの画面にレンダリングします。

TVSDKは、広告を解決し、広告をタイムラインに配置し、画面上のコンテンツのレンダリングを試みます。

次のようなフェーズで、エラーの主なクラスが発生する可能性があります。

* ホストサーバーに接続する場合。
* マニフェストファイルのダウンロード時。
* メディアセグメントのダウンロード時。

TVSDKは、次の場合にトリガーされる通知イベントを含む、トリガーされたイベントをアプリケーションに転送します。

* フェイルオーバーが発生します。
* プロファイルは、フェイルオーバーアルゴリズムのために変更されます。
* すべてのフェイルオーバーオプションが考慮され、追加のアクションを自動的に実行することはできません。

   アプリケーションが適切なアクションを実行する必要があります。

エラーが発生したかどうかに関係なく、TVSDKは、それぞれお `onAdBreakComplete` よびすべ `onAdBreakStart` てに対して `onAdComplete` 呼び出しま `onAdStart`す。 ただし、セグメントをダウンロードできない場合は、タイムラインにギャップが生じる可能性があります。 ギャップが十分に大きい場合、再生ヘッド位置の値と、報告された広告の進行状況に不連続が生じる可能性があります。
