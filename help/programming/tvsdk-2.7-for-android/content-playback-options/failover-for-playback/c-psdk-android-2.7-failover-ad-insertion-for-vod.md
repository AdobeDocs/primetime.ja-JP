---
description: ビデオオンデマンド (VOD) 広告挿入プロセスは、広告解決、広告挿入、広告再生の各フェーズで構成されます。 広告トラッキングの場合、 TVSDK は、各広告の再生の進行状況をリモートトラッキングサーバーに通知する必要があります。 予期しない状況が発生した場合、 TVSDK は適切なアクションを実行します。
title: VOD 用の広告の挿入とフェイルオーバー
source-git-commit: 02ebc3548a254b2a6554f1ab34afbb3ea5f09bb8
workflow-type: tm+mt
source-wordcount: '689'
ht-degree: 0%

---

# VOD 用の広告の挿入とフェイルオーバー {#advertising-insertion-and-failover-for-vod}

ビデオオンデマンド (VOD) 広告挿入プロセスは、広告解決、広告挿入、広告再生の各フェーズで構成されます。 広告トラッキングの場合、 TVSDK は、各広告の再生の進行状況をリモートトラッキングサーバーに通知する必要があります。 予期しない状況が発生した場合、 TVSDK は適切なアクションを実行します。

## 広告解決フェーズ {#section_5DD3A7DA79E946298BFF829A60202E1C}

TVSDK は、Adobe Primetime Ad Decisioning などの広告配信サービスと通信し、広告のビデオストリームに対応するプライマリプレイリストファイルを取得しようとします。 広告解決フェーズ中に、 TVSDK はリモート広告配信サーバーに対して HTTP 呼び出しをおこない、サーバーの応答を解析します。

TVSDK は、次のタイプの広告プロバイダーをサポートしています。

* メタデータ広告プロバイダー

  広告のデータは、プレーンテキストの JSON ファイルでエンコードされます。
* Primetime ad decisioning 広告プロバイダー

  TVSDK は、一連のターゲティングパラメーターとアセット ID 番号を含むリクエストを Primetime ad decisioningback-end サーバーに送信します。 Primetime ad decisioning は、必要な広告情報を含む同期されたマルチメディア統合言語 (SMIL) ドキュメントを使用して応答します。
* カスタム広告マーカープロバイダー

  広告がサーバー側からストリームに焼き込まれる状況を処理します。 TVSDK は、実際の広告挿入を実行しませんが、サーバー側で挿入された広告を追跡する必要があります。 このプロバイダーは、TVSDK が広告トラッキングの実行に使用する広告マーカーを設定します。

このフェーズでは、次のフェールオーバー状況の 1 つが発生する可能性があります。

* 例えば、接続がない場合や、リソースが見つからない場合など、サーバー側のエラーが発生している場合は、データを取得できません。
* データは取得されましたが、形式が無効です。

  これは、例えば、受信データの解析に失敗した場合に発生する可能性があります。

TVSDK は、エラーに関する警告通知を発行し、処理を続行します。

## 広告挿入フェーズ {#section_29F7F7756C8B40B99AD4C3DD16B72B5B}

TVSDK は、メインコンテンツに対応するタイムラインに代替コンテンツ（広告）を挿入します。

広告解決フェーズが完了すると、 TVSDK は、広告の時間にグループ化された、広告リソースの順序付きリストを持ちます。 各広告ブレークは、ミリ秒 (ms) 単位の開始時間値を使用してメインコンテンツタイムライン上に配置されます。 広告ブレークの各広告には、duration プロパティもミリ秒単位で表現されます。 広告ブレーク内の広告はチェーンになっているので、広告ブレークの期間は、構成する個々の広告の時間の合計に等しくなります。

このフェーズでは、広告挿入時にタイムライン上で発生する可能性のある競合が発生し、フェールオーバーが発生する可能性があります。 広告ブレークの開始時間/期間の値の特定の組み合わせでは、広告セグメントが重複する可能性があります。 この重複は、広告の時間の最後の部分が次の広告の時間の最初の広告の開始と交差する場合に発生します。 このような状況では、 TVSDK は後の広告ブレークを破棄し、すべての広告ブレークが挿入または破棄されるまで、リスト上の次の項目を使用して広告挿入プロセスを続行します。

TVSDK は、エラーに関する警告通知を発行し、処理を続行します。

## 広告再生フェーズ {#section_DA816F88AF8A4A5A8FD0DE2D54A86031}

TVSDK は広告セグメントをダウンロードし、デバイスの画面にレンダリングします。

これで、 TVSDK は広告を解決し、広告をタイムラインに配置し、画面上でコンテンツをレンダリングしようとします。

次のエラーの主なクラスは、次のフェーズで発生する場合があります。

* ホストサーバーに接続する場合。
* マニフェストファイルのダウンロード時。
* メディアセグメントのダウンロード時。

TVSDK は、以下の場合にトリガーされる通知イベントを含め、トリガーされたイベントをアプリケーションに転送します。

* フェイルオーバーが発生しました。
* フェールオーバーアルゴリズムが原因でプロファイルが変更されました。
* すべてのフェイルオーバーオプションが考慮され、追加のアクションは自動的に実行されません。

  アプリケーションが適切なアクションを実行する必要があります。

エラーが発生したかどうかに関係なく、 TVSDK はを呼び出します。 `onAdBreakComplete` 次の期間 `onAdBreakStart` および `onAdComplete` 次の期間ごと `onAdStart`. ただし、セグメントをダウンロードできない場合は、タイムラインに隙間が生じる可能性があります。 ギャップが十分に大きい場合、再生ヘッドの位置とレポートされる広告の進行状況の値が不連続を示す可能性があります。
