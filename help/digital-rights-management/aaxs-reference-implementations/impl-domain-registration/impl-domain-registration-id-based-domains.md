---
seo-title: IDベースのドメイン
title: IDベースのドメイン
uuid: 34cad19b-1adb-4e0c-ac59-50632f6988f7
translation-type: tm+mt
source-git-commit: 7e8df034035fe465fbe403949ef828e7811ced2e
workflow-type: tm+mt
source-wordcount: '476'
ht-degree: 0%

---


# IDベースのドメイン{#identity-based-domains}

この場合、認証済みの各ユーザーは独自のドメインを持ち、特定の数のデバイスがドメインに参加できます。 参照実装でこの種類のドメインを使用するには、ドメイン登録が必要であることを指定するポリシーを作成します。 サーバーのホストとドメインサーバーURLのポートを指定し、ユーザー名とパスワードの認証が必要です。

参照の実装では、ドメイン登録の次のロジックが実装されます。

1. このユーザーに割り当てるドメイン名を決定します。 ドメイン名は、認証トークンから抽出された* `namequalifier:username`*になります。 認証トークンがない場合は、エラーDOM_AUTHENTICATION_REQUIRED (503)を返します。
1. `DomainServerInfo`テーブルのドメイン名を参照します。 エントリが見つからない場合は、テーブルにエントリを挿入します（デフォルト値は認証が必要で、max domain membership=5）。
1. デバイスが既にドメインに登録されているかどうかを確認します。

   1. `UserDomainMembership`テーブルのドメイン名を参照します。 見つかったマシンIDごとに、リクエスト内のマシンIDと比較します。 これが新しいマシンの場合は、`UserDomainMembership`テーブルにエントリを追加します。 次に、`UserDomainRefCount`テーブルで一致するレコードを探します。 このマシンのGUIDにエントリが存在しない場合は、レコードを追加します。

   1. 新しいデバイスで、Max Membershipに既に到達している場合、エラーDOM_LIMIT_REACHED (502)を返します。

1. DomainKeysテーブルで、このドメインのすべてのドメインキーを参照します。

   1. `DomainServerInfo`がキーをロールオーバーする必要があることを示した場合は、新しいキーペアを生成し、`DomainKeys`テーブルに保存して（キーのバージョンが最も高い既存のキーよりも1つ高い）、`DomainServerInfo`の「キーのロールオーバーが必要」フラグをリセットします。

   1. 各ドメインキーに対して、ドメイン秘密鍵証明書を生成します。

このリファレンス実装では、ドメインの登録解除のために次のロジックが実装されています。

1. このユーザーに割り当てるドメイン名を決定します。 ドメイン名は、認証トークンから抽出された&#x200B;*namequalifier:username*&#x200B;になります。 認証トークンがない場合は、エラーDOM_AUTHENTICATION_REQUIRED (503)を返します。
1. `DomainServerInfo`テーブル内の要求されたドメイン名を参照します。
1. `UserDomainMembership`テーブルのドメイン名を参照します。 見つかったマシンIDごとに、リクエスト内のマシンIDと比較します。 `UserDomainRefCount`テーブルで対応するエントリを探します。 一致するエントリが見つからない場合は、エラーDEREG_DENIED (401)を返します。

1. これがプレビューリクエストでない場合は、`UserDomainRefCount`テーブルからエントリを削除します。 マシンのエントリがこれ以上ない場合は、`UserDomainMembership`からエントリを削除し、`DomainServerInfo`に「キーのロールオーバーが必要」フラグを設定します。

この場合、各ユーザーが少数のマシンを登録できるので、完全なマシンIDと`matches()`メソッドを使って、マシンを正確にカウントできます。 ただし、ユーザーが（異なるブラウザーの複数のAIRアプリケーションまたはプレーヤーを介して）このマシンに複数回登録できるので、サーバーでも参照カウントを維持する必要があるので、登録解除を正確にカウントできます。 マシン上のすべてのドメイントークンが放棄されるまで、登録解除は完了と見なすことはできません。
