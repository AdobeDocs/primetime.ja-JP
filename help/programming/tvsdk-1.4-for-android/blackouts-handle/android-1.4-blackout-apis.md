---
description: ライブビデオストリームでブラックアウトを処理し、ブラックアウト中に代替コンテンツを提供できます。
title: ブラックアウト API 要素
source-git-commit: 02ebc3548a254b2a6554f1ab34afbb3ea5f09bb8
workflow-type: tm+mt
source-wordcount: '578'
ht-degree: 0%

---

# ブラックアウト API 要素{#blackout-api-elements}

ライブビデオストリームでブラックアウトを処理し、ブラックアウト中に代替コンテンツを提供できます。

ライブストリームでブラックアウトが発生した場合、プレーヤーではイベントハンドラーを使用してブラックアウトを検出し、メインストリームを視聴する資格のないユーザーに代替コンテンツを提供します。 プレーヤーでは、ブラックアウト期間の開始と終了を検出し、再生をメインストリームから代替ストリームに切り替え、ブラックアウト期間が終了したらメインストリームに切り替えます。

ライブストリーム内のブラックアウトを処理するには：

1. ライブストリームマニフェスト内のブラックアウトタグをサブスクライブすることで、ブラックアウトタグを検出するアプリを設定します。

   TVSDK は、ブラックアウトタグを単独では検出しません。マニフェストファイルの解析中にタグを検出した場合に通知を受け取るには、ブラックアウトタグをサブスクライブする必要があります。
1. プレーヤーがサブスクライブされているタグ（この場合は PLAYBACK タグと BLACKOUTS タグ）用のイベントリスナーを作成します。

   プレーヤーがフォアグラウンド（メインコンテンツ）またはバックグラウンド（代替コンテンツ）のストリームマニフェストで（ブラックアウトタグなど）をサブスクライブした場合、 TVSDK は `TimedMetadataEvent` とは、 `TimedMetadataObject` （の） `TimedMetadataEvent`.

1. フォアグラウンドストリームとバックグラウンドストリームの両方に対して、時間指定メタデータイベントのハンドラーを実装します。

   これらのハンドラーで、時間指定メタデータイベントオブジェクトから、ブラックアウト期間の開始時間と終了時間を取得します。
1. ブラックアウト期間の開始および終了時にコンテンツを切り替えるメソッドを作成します。

   ブラックアウト期間が開始したら、メインコンテンツをバックグラウンドに切り替え、代替コンテンツをメインストリームに切り替えます。 バックグラウンドで元のマニフェストを取得して解析し続け、「ブラックアウト終了」タグを確認し続けます。これにより、ブラックアウトが終了したときにプレーヤーが元のストリームに再結合できるようになります。
1. ブラックアウトの範囲が再生ストリームの DVR に含まれる場合は、シーク不可能な範囲を更新します。

   の追跡と処理 `TimedMetadata` バックグラウンドストリーム上で、ブラックアウトシーク不可能範囲を準備および更新することによって行われます。

TVSDK は、メソッド、メタデータ、通知などのブラックアウトを実装する際に役立つ API エレメントを提供します。

プレーヤーにブラックアウトソリューションを実装する際には、次の機能を使用できます。

* **MediaPlayer**

   * `registerCurrentItemAsBackgroundItem` 現在読み込まれているリソースをバックグラウンドリソースとして保存します。 次の場合 `replaceCurrentResource` がこのメソッドの後に呼び出されると、を呼び出すまで、 TVSDK はバックグラウンドアイテムのマニフェストのダウンロードを続行します。 `unregisterCurrentBackgroundItem`, `release`または `reset`.

   * `unregisterCurrentBackgroundItem` バックグラウンドアイテムを null に設定し、バックグラウンドマニフェストの取得と解析を停止します。

* **BlackoutMetadata** -

  ブラックアウトに固有の Metadata クラス。

  これにより、シーク不可能範囲 ( `TimeRanges`) を TVSDK に追加します。 TVSDK は、ユーザーがシークするたびに、これらの範囲を確認します。 設定済みで、ユーザーがシーク不可能範囲にシークした場合、 TVSDK は視聴者をシーク不可能範囲の終わりまで強制的に移動させます。

* **次の ADVERTISINGMetadata を開始する** ライブストリーム上のプリロールを有効または無効にするには、 `enableLivePreroll` を true または false に設定します。 false の場合、 TVSDK は、コンテンツ再生前にプリロール広告に対する明示的な広告サーバー呼び出しをおこなわないので、プリロールは再生されません。 ミッドロールには影響しません。 デフォルトは true です。

* **MediaPlayer.BlackoutsEventListener**

   * `onTimedMetadataInBackgroundItem`  — バックグラウンドマニフェストにサブスクライブ済みのタグが検出され、新しい `TimedMetadata` インスタンスがそのインスタンスから準備されます。 The `TimedMetadata` インスタンスがパラメーターとしてディスパッチされます。

   * `onBackgroundManifestFailed`  — メディアプレーヤーがバックグラウンドマニフェストの読み込みに完全に失敗した、つまり、すべてのストリーム URL がエラーまたは無効な応答を返す場合にディスパッチされます。

* **通知**

   * `BACKGROUND_MANIFEST_WARNING`

      * コード：204000
      * タイプ：警告
      * バックグラウンドマニフェストのダウンロード中にエラーが発生しました。
