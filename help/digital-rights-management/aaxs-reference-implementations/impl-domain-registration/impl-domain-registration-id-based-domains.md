---
seo-title: IDベースのドメイン
title: IDベースのドメイン
uuid: 34cad19b-1adb-4e0c-ac59-50632f6988f7
translation-type: tm+mt
source-git-commit: 7e8df034035fe465fbe403949ef828e7811ced2e

---


# IDベースのドメイン {#identity-based-domains}

この使用例では、認証された各ユーザーが独自のドメインを持ち、特定の数のデバイスがドメインに参加できます。 この種類のドメインを参照実装で使用するには、ドメイン登録を指定するポリシーを作成する必要があります。 ドメインサーバーのURLに使用するサーバーのホストとポートを指定し、ユーザー名とパスワードの認証が必要であることを指定します。

参照実装では、ドメイン登録用に次のロジックが実装されます。

1. このユーザーに割り当てるドメイン名を決定します。 ドメイン名は、認証トーク `namequalifier:username`ンから**抽出されます。 認証トークンがない場合は、エラーDOM_AUTHENTICATION_REQUIRED (503)を返します。
1. テーブル内のドメイン名を参照 `DomainServerInfo` します。 エントリが見つからない場合は、テーブルにエントリを挿入します（デフォルト値は認証が必要で、最大ドメインメンバーシップ=5）。
1. デバイスがドメインに既に登録されているかどうかを確認します。

   1. テーブル内のドメイン名を参照 `UserDomainMembership` します。 見つかった各マシンIDについて、リクエスト内のマシンIDと比較します。 これが新しいマシンの場合は、テーブルにエントリを追加し `UserDomainMembership` ます。 次に、一致するレコードをテーブルで検索 `UserDomainRefCount` します。 このマシンGUIDのエントリが存在しない場合は、レコードを追加します。

   1. 新しいデバイスで、既に最大メンバーシップに達している場合は、エラーDOM_LIMIT_REACHED (502)を返します。

1. [DomainKeys]テーブルで、このドメインのすべてのドメインキーを参照します。

   1. キーを `DomainServerInfo` ロールオーバーする必要がある場合は、新しいキーペアを生成し、テーブルに保存して（キーのバージョンが最も高い既存のキーよりも1つ高い）、の「キーのロールオーバーが必要」フラグをリセットしま `DomainKeys``DomainServerInfo`す。

   1. 各ドメインキーに対して、ドメイン秘密鍵証明書を生成します。

参照実装では、ドメインの登録解除のために次のロジックが実装されています。

1. このユーザーに割り当てるドメイン名を決定します。 ドメイン名は、認証トー *クンから抽出された* namequalifier:usernameになります。 認証トークンがない場合は、エラーDOM_AUTHENTICATION_REQUIRED (503)を返します。
1. テーブル内の要求されたドメイン名を参照 `DomainServerInfo` します。
1. テーブル内のドメイン名を参照 `UserDomainMembership` します。 見つかった各マシンIDについて、リクエスト内のマシンIDと比較します。 テーブル内の対応するエントリを探 `UserDomainRefCount` します。 一致するエントリが見つからない場合は、エラーDEREG_DENIED (401)を返します。

1. プレビューリクエストでない場合は、テーブルからエントリを削除 `UserDomainRefCount` します。 マシンのテーブルにこれ以上エントリがない場合は、からエントリを削除し、の「キ `UserDomainMembership` ーのロールオーバーが必要」フラグを設定しま `DomainServerInfo`す。

この場合、各ユーザーが少数のマシンを登録できるので、マシンID全体と方法を使用して、マシンを正確にカウントす `matches()` ることができます。 ただし、ユーザーが（異なるブラウザーの複数のAIRアプリケーションまたはプレーヤーを介して）このマシンに複数回登録できる場合は、登録解除を正確にカウントできるように、参照カウントも維持する必要があります。 マシン上のすべてのドメイントークンが引き渡されるまで、登録解除が完了したと見なすことはできません。
