---
description: ライブビデオストリームのブラックアウトを処理し、ブラックアウト中に代替コンテンツを提供できます。
seo-description: ライブビデオストリームのブラックアウトを処理し、ブラックアウト中に代替コンテンツを提供できます。
seo-title: ブラックアウトAPI要素
title: ブラックアウトAPI要素
uuid: 263a8987-0c85-493a-9352-9605c877ba65
translation-type: tm+mt
source-git-commit: 5908e5a3521966496aeec0ef730e4a704fddfb68

---


# ブラックアウトAPI要素{#blackout-api-elements}

ライブビデオストリームのブラックアウトを処理し、ブラックアウト中に代替コンテンツを提供できます。

ライブストリームでブラックアウトが発生した場合、プレーヤーは、イベントハンドラーを使用してブラックアウトを検出し、メインストリームを視聴する資格のないユーザーに代替コンテンツを提供します。 プレイヤーはブラックアウト期間の開始と終了を検出し、再生をメインストリームから代替ストリームに切り替え、ブラックアウト期間が終了するとメインストリームに切り替えます。

ライブストリームのブラックアウトを処理するには：

1. ライブストリームマニフェスト内のブラックアウトタグをサブスクライブして、ブラックアウトタグを検出するようにアプリを設定します。

   TVSDKは、ブラックアウトタグを単独で検出しません。マニフェストファイルの解析中にタグが検出された場合に通知を受け取るには、ブラックアウトタグをサブスクライブする必要があります。
1. プレイヤーがサブスクライブするタグ（この場合は、PLAYBACKタグとBLACKOUTSタグ）のイベントリスナーを作成します。

   プレイヤーがフォアグラウンド（メインコンテンツ）またはバックグラウンド（代替コンテンツ）のストリームマニフェストでサブスクライブしたタグ（ブラックアウトタグなど）が発生すると、TVSDKは、をディスパッチし、そのためのを `TimedMetadataEvent` 作成しま `TimedMetadataObject``TimedMetadataEvent`す。

1. フォアグラウンドストリームとバックグラウンドストリームの両方に対して、時間指定メタデータイベントのハンドラーを実装します。

   これらのハンドラーで、時間指定メタデータイベントオブジェクトから、ブラックアウト期間の開始時間と終了時間を取得します。
1. ブラックアウト期間の開始と終了時にコンテンツを切り替えるメソッドを作成します。

   ブラックアウト期間が始まったら、メインコンテンツをバックグラウンドに切り替え、代替コンテンツをメインストリームに切り替えます。 引き続き、バックグラウンドで元のマニフェストの取得と解析を行い、「ブラックアウト終了」タグをチェックし続けます。これにより、ブラックアウトが終了したときにプレイヤーが元のストリームに再び参加できるようになります。
1. ブラックアウト範囲が再生ストリームのDVRにある場合は、シーク不可能範囲を更新します。

   ブラックアウトシーク不可能範囲を `TimedMetadata` 準備および更新することで、バックグラウンドストリーム上のを追跡し、処理します。

TVSDKは、メソッド、メタデータ、通知など、ブラックアウトの実装時に役立つAPI要素を提供します。

プレイヤーにブラックアウトソリューションを実装する場合は、以下を使用できます。

* **MediaPlayer**

   * `registerCurrentItemAsBackgroundItem` 現在読み込まれているリソースをバックグラウンドリソースとして保存します。 このメ `replaceCurrentResource` ソッドの後にを呼び出すと、、、またはを呼び出すまで、TVSDKはバックグラウンドアイテムのマニフェストのダ `unregisterCurrentBackgroundItem`ウンロー `release`ドを続行しま `reset`す。

   * `unregisterCurrentBackgroundItem` バックグラウンドアイテムをnullに設定し、バックグラウンドマニフェストのフェッチと解析を停止します。

* **BlackoutMetadata** -

   ブラックアウトに固有のMetadataクラス。

   これにより、TVSDKでシーク不可能範囲（の配列）を設定 `TimeRanges`できます。 TVSDKは、ユーザーがシークするたびにこれらの範囲をチェックします。 設定され、ユーザーがシーク不可能な範囲をシークした場合、TVSDKは、ビューアをシーク不可能な範囲の最後まで強制的に移動させます。

* **START HERE NEXT AdvertisingMetadata** : trueまたはfalseに設定して、ライブストリームのプリロールを有効 `enableLivePreroll` または無効にします。 falseの場合、TVSDKは、コンテンツ再生前にプリロール広告に対する明示的な広告サーバー呼び出しを行わないので、プリロールは再生されません。 これはミッドロールには影響しません。 デフォルトはtrueです。

* **MediaPlayer.BlackoutsEventListener**

   * `onTimedMetadataInBackgroundItem`  — バックグラウンドマニフェストでサブスクライブされたタグを検出し、そこから新しいインスタ `TimedMetadata` ンスを作成した場合にディスパッチされます。 インスタンス `TimedMetadata` は、パラメーターとしてディスパッチされます。

   * `onBackgroundManifestFailed`  — メディアプレイヤーがバックグラウンドマニフェストの読み込みに完全に失敗した、つまり、すべてのストリームURLがエラーまたは無効な応答を返した場合にディスパッチされます。

* **通知**

   * `BACKGROUND_MANIFEST_WARNING`

      * コード：204000
      * タイプ：警告
      * バックグラウンドマニフェストのダウンロード中にエラーが発生しました。