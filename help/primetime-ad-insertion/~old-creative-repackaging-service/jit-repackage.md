---
description: クライアントビデオプレーヤーまたはマニフェストサーバーがCRSとやり取りし、JITの再パッケージ化を実現できます。 どちらも同じ広告選択ロジックを使用します。
title: JIT再パッケージの詳細ワークフロー
translation-type: tm+mt
source-git-commit: 89bdda1d4bd5c126f19ba75a819942df901183d1
workflow-type: tm+mt
source-wordcount: '524'
ht-degree: 0%

---


# JIT再パッケージ化の詳細ワークフロー{#detailed-workflows-for-jit-repackaging}

クライアントビデオプレーヤーまたはマニフェストサーバーがCRSとやり取りし、JITの再パッケージ化を実現できます。 どちらも同じ広告選択ロジックを使用します。

## マニフェストサーバーによって開始されたJITの再パッケージ化{#section_1F1C1B7DD146403890C2B43E24FEF0EB}

![](assets/ssai_JIT-workflow_web.png)

マニフェストサーバー側でのJIT再パッケージ化のワークフローは次のとおりです。

1. マニフェストサーバーが広告サーバーにリクエストを行います。
1. マニフェストサーバーは、HLS形式ではない広告クリエイティブを受け取ります。
1. マニフェストサーバーは、以前にトランスコードされたHLSバージョンの広告クリエイティブの要求をCDNサーバーに送信します。

   >[!NOTE]
   >
   >マルチCDN設定では、マニフェストサーバーはブートストラップURLの`ptcdn`パラメーターを使用してCDNサーバーを識別します。

1. マニフェストサーバーが応答を確認します。

   1. 要求が正常に完了すると、マニフェストサーバーは、以前にトランスコードされた広告クリエイティブのHLSバージョンをコンテンツストリームに挿入します。
   1. 要求が失敗した場合、マニフェストサーバーはログエントリを生成し、CRSからトランスコードされたバージョンを要求します。

1. CRSは広告クリエイティブをトランスコードし、将来の使用のためにHLSバージョンをCDNサーバーにアップロードします。

そのクリエイティブに対する以降のすべての要求で、マニフェストサーバーはCDNからHLSバージョンを取得し、コンテンツストリームに挿入します。

## クライアント{#section_FBC97D40043F4FDD98247A08BB6195B0}が開始したJITの再パッケージ化

<!--<a id="fig_hkn_ndt_3z"></a>-->

![](assets/ssai_JIT-workflow_client_web.png)

TVSDKに基づくクライアントまたは類似の機能を持つクライアントは、CRSとやり取りして、次のようにJITの再パッケージ化を実行できます。

1. クライアントが広告サーバーに広告をリクエストします。
1. 広告サーバーが広告をクライアントに返します。
1. クライアントは、広告サーバーから広告の形式を確認します。

   1. 広告クリエイティブがHLS形式の場合、クライアントは広告をコンテンツに挿入（ステッチ）し、完了します。
   1. 広告クリエイティブがHLS形式でない場合、クライアントはCDNサーバーから要求します。

      >[!NOTE]
      >
      >マルチCDN設定では、マニフェストサーバーはブートストラップURLの`ptcdn`パラメーターを使用してCDNサーバーを識別します。

1. クライアントがCDNサーバーからの応答を確認します。

   1. CDNがHLSバージョンを提供した場合、クライアントはHLSバージョンをコンテンツに挿入（ステッチ）し、完了します。
   1. CDNサーバーがHLSバージョンを提供しない場合、クライアントは広告サーバーにCRSから広告バージョンを要求します。 クライアントは広告をコンテンツに挿入しません。

1. 広告サーバーは、非HLSをHLSにトランスコードするように要求します。
1. CRSは、HLSバージョンを作成し、将来的に使用するためにCDNサーバーにアップロードします。

## 広告形式の優先度とタイムライン{#section_A74DE37A57BF45D7B6D09E3DE40F8E61}

マニフェストサーバーとクライアントは、同じ選択ロジックを使用して、使用可能な広告を再生する優先順位を決定します。 HLS形式の広告が最初の優先順位で、次にMP4、FLV、最後にWebMが順に続きます。

CRSは通常、HLS以外の広告クリエイティブを処理するのに2 ～ 4分必要で、通常3分未満です。

CRSは様々なHLSビットレートを生成するので、広告は使用可能な接続速度と帯域幅に適した速度で再生できます。 使用可能なビットレートが複数ある場合は、使用可能な最も高いビットレートがCRSによって選択されます。 CRSがHLS以外の広告クリエイティブを受け取る場合、HLSバージョンは使用可能な最高の解像度で生成されます。