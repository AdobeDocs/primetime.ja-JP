---
description: ライブおよびビデオオンデマンド(VOD)メディアの場合、TVSDKは、中解像度ビットレートに関連付けられたプレイリストをダウンロードして再生し、そのプレイリストで定義されたメディアセグメントをダウンロードします。 高解像度ビットレートプレイリストと関連メディアをすばやく選択し、ダウンロード処理を続行します。
seo-description: ライブおよびビデオオンデマンド(VOD)メディアの場合、TVSDKは、中解像度ビットレートに関連付けられたプレイリストをダウンロードして再生し、そのプレイリストで定義されたメディアセグメントをダウンロードします。 高解像度ビットレートプレイリストと関連メディアをすばやく選択し、ダウンロード処理を続行します。
seo-title: メディアの再生とフェイルオーバー
title: メディアの再生とフェイルオーバー
uuid: 197a6ee0-f1ff-40ac-bd49-eafeae6167d4
translation-type: tm+mt
source-git-commit: 040655d8ba5f91c98ed0584c08db226ffe1e0f4e
workflow-type: tm+mt
source-wordcount: '703'
ht-degree: 0%

---


# メディアの再生とフェイルオーバー{#media-playback-and-failover}

ライブおよびビデオオンデマンド(VOD)メディアの場合、TVSDKは、中解像度ビットレートに関連付けられたプレイリストをダウンロードして再生し、そのプレイリストで定義されたメディアセグメントをダウンロードします。 高解像度ビットレートプレイリストと関連メディアをすばやく選択し、ダウンロード処理を続行します。

## プレイリストのフェイルオーバー{#section_E6B6A15930894F56A0A8501577B35E7F}が見つかりません

プレイリスト全体が見つからない場合（例えば、最上位のマニフェストファイルで指定されているM3U8ファイルがダウンロードされない場合）、TVSDKは回復を試みます。 回復できない場合は、次のステップをアプリケーションが決定します。

中解像度ビットレートに関連付けられているプレイリストがない場合、TVSDKは同じ解像度のバリアントプレイリストを検索します。 同じ解像度が見つかった場合、開始はバリアントプレイリストとセグメントを一致する位置からダウンロードします。 TVSDKが同じ解像度プレイリストを見つけない場合、他のビットレートプレイリストとそのバリアントを順に切り替えようとします。 ビットレートがすぐ下の場合は最初の選択肢で、その次にそのバリアントなどがこれに該当します。 有効なプレイリストを見つけようとして、下位のビットレート再生リストとそのバリアントがすべて使い果たされた場合、TVSDKは最上位のビットレートに移動し、そこからカウントダウンします。 有効なプレイリストが見つからない場合、プロセスは失敗し、プレイヤーはERROR状態に移行します。

この状況の処理方法は、アプリケーションが決定できます。 例えば、プレイヤーアクティビティを閉じて、カタログアクティビティに移動させることができます。 関心のあるイベントは`STATUS_CHANGED`イベントで、対応するコールバックは`onStatusChange`メソッドです。 以下のコードは、プレイヤーが内部状態をERRORに変更したかどうかを監視するものです。

詳しくは、`PSDKDemo`ファイルを参照してください。 イベントリスナーは、MediaPlayerインスタンスに接続されます。

```
case MediaPlayerStatus.ERROR: 
Alert.show(event.error.toString(), “Error occurred”); 
break;
```

クライアント側のネットワークがダウンしている場合は、このコードを使用して検証できます。

```
psdkutils::PSDKString 
getNetworkDownVerificationUrl() const { return 
_networkDownVerificationUrl; }
```

APIは、クライアント側のネットワークがダウンしているかどうかを検証するために使用されるURLを提供します。 HTTP要求時にhttp応答コード200を返す有効なURLを指定する必要があります。

```
psdkutils::PSDKErrorCode 
 setNetworkDownVerificationUrl(psdkutils::PSDKString value) {  
_networkDownVerificationUrl = value; return psdkutils::kECSuccess; }
```

setNetworkDownVerificationUrlが設定されていない場合、TVSDKは、デフォルトでMainManifest urlを使用して、ネットワークがダウンしているかどうかを示します。

## セグメントのフェイルオーバー{#section_ED8CF666289042D39E9914D42BDD9BA4}がありません

特定のセグメントが見つからない場合（特定のセグメントのダウンロードに失敗した場合など）、TVSDKは様々なフェイルオーバーを通じて回復を試みます。 回復できない場合は、エラーを発行します。

例えばマニフェストファイルが存在しないためにサーバー上にセグメントが見つからない場合、セグメントをダウンロードできず、以下のオプションを試してTVSDKはフェイルオーバーを試みます。

1. バリアントファイル内の同じビットレートで、同じセグメントへのフェイルオーバーを試みます。
1. 同じファイル内の代替ビットレートに切り替えます（ABRスイッチ）。
1. 使用可能なすべてのバリアント内の使用可能なすべてのビットレートを順に調べます。
1. セグメントをスキップして警告を発行します。

TVSDKは、代替セグメントを取得できない場合、`CONTENT_ERROR`エラー通知をトリガーします。 この通知には、コード`DOWNLOAD_ERROR`コードの内部通知が含まれています。 問題のあるストリームが代替オーディオトラックの場合、TVSDKは`AUDIO_TRACK_ERROR`エラー通知を生成します。

ビデオエンジンが引き続きセグメントを取得できない場合、セグメントの連続スキップ回数は5に制限されます。5に制限された後は、再生が停止され、TVSDKはコード5の`NATIVE_ERROR`を発行します。

>[!NOTE]
>
>可変ビットレート(ABR)制御パラメーターは、フェイルオーバーが発生した場合には考慮されません。 これは、フェイルオーバーメカニズムが、ビットレートのプロファイルに関係なく、現在使用可能なプレイリストのいずれかをバックアップストリームとして使用するように設計されているためです。
>
>フェイルオーバー操作中は、プロファイルスイッチが存在する可能性があります。 プレイリストセグメントの1つのダウンロード中にエラーが発生した場合、最小/最大許容ビットレートなどのABR制御パラメーターは無視されます。

