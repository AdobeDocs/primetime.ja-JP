---
description: ビデオオンデマンド(VOD)の広告挿入プロセスは、広告解決、広告挿入および広告再生の各段階で構成されます。 広告トラッキングの場合、TVSDKは、各広告の再生の進行状況をリモートトラッキングサーバーに通知する必要があります。 予期しない状況が発生した場合は、適切なアクションを実行します。
seo-description: ビデオオンデマンド(VOD)の広告挿入プロセスは、広告解決、広告挿入および広告再生の各段階で構成されます。 広告トラッキングの場合、TVSDKは、各広告の再生の進行状況をリモートトラッキングサーバーに通知する必要があります。 予期しない状況が発生した場合は、適切なアクションを実行します。
seo-title: VODの広告挿入とフェイルオーバー
title: VODの広告挿入とフェイルオーバー
uuid: 98505f63-ac43-4ff5-9f7b-895b6135df47
translation-type: tm+mt
source-git-commit: 040655d8ba5f91c98ed0584c08db226ffe1e0f4e

---


# VODの広告挿入とフェイルオーバー{#advertising-insertion-and-failover-for-vod}

ビデオオンデマンド(VOD)の広告挿入プロセスは、広告解決、広告挿入および広告再生の各段階で構成されます。 広告トラッキングの場合、TVSDKは、各広告の再生の進行状況をリモートトラッキングサーバーに通知する必要があります。 予期しない状況が発生した場合は、適切なアクションを実行します。

## 広告解決フェーズ {#section_0D45C6094D724B55868B48F9A3557A8B}

TVSDKは、Adobe Primetime ad decisioningなどの広告配信サービスに接続し、広告のビデオストリームに対応するプライマリプレイリストファイルの取得を試みます。 広告解決フェーズ中に、TVSDKはリモート広告配信サーバーに対するHTTP呼び出しを行い、サーバーの応答を解析します。

TVSDKは、次のタイプの広告プロバイダーをサポートしています。

* メタデータ広告プロバイダー

   広告データはプレーンテキストのJSONファイルにエンコードされます。
* Primetime ad decisioning広告プロバイダー

   TVSDKは、一連のターゲティングパラメーターとアセットID番号を含むリクエストをPrimetime ad decisioningバックエンドサーバーに送信します。 Primetime ad decisioningは、必要な広告情報を含むSMIL（同期マルチメディア統合言語）ドキュメントを応答します。

このフェーズでは、次のいずれかのフェイルオーバー状況が発生する可能性があります。

* 接続の不足や、リソースが見つからないなどのサーバー側のエラーが原因で、データを取得できません。
* データが取得されましたが、形式が無効です。

   これは、例えば、受信データの解析に失敗した場合に発生する可能性があります。

TVSDKは、エラーに関する警告通知を発行し、処理を続行します。

## 広告挿入フェーズ {#section_1B18E8B5768B4873B3346294175B7340}

TVSDKは、メインコンテンツに対応するタイムラインに代替コンテンツ（広告）を挿入します。

広告解決フェーズが完了すると、TVSDKは、広告の時間にグループ化された広告リソースの順番に並べられたリストを持ちます。 各広告の時間は、ミリ秒（ミリ秒）で表される開始時間値を使用して、メインコンテンツのタイムライン上に配置されます。 広告の時間内の各広告には、同時にミリ秒単位で表されるdurationプロパティがあります。 広告の時間内の広告は、次々に連結されます。 その結果、広告の時間の長さは、構成する個々の広告の継続時間の合計と等しくなります。

このフェーズでは、広告挿入中にタイムラインで発生する可能性のある競合と共に、フェイルオーバーが発生する可能性があります。 広告の時間の開始時間/時間の値を特定の組み合わせで組み合わせると、広告セグメントが重複する場合があります。 重複は、広告の時間の最後の部分が、次の広告の時間の最初の広告の先頭と交差する場合に発生します。 このような状況では、後の広告の時間を破棄し、すべての広告の時間が挿入または破棄されるまで、リストの次の項目を使用して広告挿入プロセスを続行します。

TVSDKは、エラーに関する警告通知を発行し、処理を続行します。

## 広告再生フェーズ {#section_64777BD2CDA84EACB0A4EA6D68367CF5}

TVSDKは、広告セグメントをダウンロードし、デバイスの画面にレンダリングします。

この時点で、TVSDKは広告を解決し、タイムラインに配置して、画面上のコンテンツのレンダリングを試みます。

このフェーズでは、次のようなエラーのメインクラスが発生する可能性があります。

* ホストサーバーへの接続時のエラー
* マニフェストファイルのダウンロード時のエラー
* メディアセグメントのダウンロード時のエラー

TVSDKは、3つのエラークラスすべてに対して、次のようなトリガーされたイベントをアプリケーションに転送します。

* フェイルオーバーの発生時にトリガーされる通知イベント。
* フェイルオーバーアルゴリズムが原因でプロファイルが変更された場合の通知イベント。
* すべてのフェイルオーバーオプションが考慮され、追加のアクションを自動的に実行できない場合にトリガーされる通知イベント。

   アプリケーションが適切なアクションを実行する必要があります。

エラーが発生したかどうかに関わらず、TVSDKは各エ `AdBreakPlaybackEvent.AD_BREAK_COMPLETE` ラーと各エ `AdBreakPlaybackEvent.AD_BREAK_STARTED` ラーを `AdPlaybackEvent.AD_COMPLETED` 呼び出しま `AdPLaybackEvent.AD_STARTED`す。 ただし、セグメントをダウンロードできない場合は、タイムラインにギャップが生じる可能性があります。 ギャップが十分に大きい場合、再生ヘッド位置の値と、報告された広告の進行状況に不連続が生じる可能性があります。
